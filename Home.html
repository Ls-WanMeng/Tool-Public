<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™æ€API-æ’­æ”¾å™¨ä¸¨æŒ½æ¢¦â¡é—é…’ æä¾›</title>
    <style>
        :root {
            --main-color: #FF2D55;
            --bg-color: #000;
            --text-color: #fff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
        }
        
        .player-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            display: none;
        }
        
        #videoElement, .player-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: var(--bg-color);
        }
        
        .controls-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 12px;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            transition: opacity 0.3s;
            z-index: 10;
        }
        
        .controls-row, .url-tool-buttons {
            display: flex;
            align-items: center;
            margin-top: 8px;
        }
        
        .progress-container, .volume-slider {
            width: 100%;
            height: 3px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--main-color);
            border-radius: 3px;
            width: 0%;
        }
        
        .time-display {
            font-size: 12px;
            color: var(--text-color);
            margin: 0 8px;
            min-width: 80px;
            text-align: center;
        }
        
        .control-btn, .url-tool-buttons button {
            background: transparent;
            border: none;
            color: var(--text-color);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .play-pause-btn {
            color: var(--main-color);
        }
        
        .control-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        .gesture-hint, .gesture-instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 15;
        }
        
        .gesture-instructions {
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            font-size: 16px;
            max-width: 80%;
            z-index: 20;
            text-align: center;
        }
        
        .gesture-instructions.show {
            opacity: 1;
        }
        
        .gesture-instructions ul {
            list-style-type: none;
            margin: 10px 0;
            padding: 0;
        }
        
        .gesture-instructions li {
            margin: 8px 0;
        }
        
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--main-color);
            animation: spin 1s ease-in-out infinite;
            z-index: 5;
            display: none;
        }
        
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .volume-slider {
            -webkit-appearance: none;
            width: 80px;
            margin: 0 8px;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: var(--main-color);
            border-radius: 50%;
            cursor: pointer;
        }
        
        .instruction-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background-color: var(--bg-color);
            z-index: 100;
        }
        
        .instruction-container h2 {
            margin-bottom: 20px;
            color: var(--main-color);
        }
        
        .instruction-container code {
            background-color: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            display: inline-block;
        }
        
        .url-tool-container {
            margin: 20px 0;
            width: 100%;
            padding: 10px;
        }
        
        #urlInput {
            width: 100%;
            height: 80px;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
        }
        
        .url-tool-buttons {
            gap: 5px;
        }
        
        .url-tool-buttons button {
            background: var(--main-color);
            color: white;
            padding: 6px 10px;
            border-radius: 3px;
            flex: 1;
        }
        
        .footer-info a {
            display: inline-block;
            padding: 6px 12px;
            background: var(--main-color);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-left: 10px;
            transition: opacity 0.2s;
        }
              /* éšè—æ‰€æœ‰åŸç”Ÿæ§ä»¶ï¼ˆé€‚ç”¨äºå›½äº§æµè§ˆå™¨ï¼‰ */
        video::-webkit-media-controls,
        video::-webkit-media-controls-enclosure,
        video::-webkit-media-controls-panel,
        video::-webkit-media-controls-play-button,
        video::-webkit-media-controls-timeline,
        video::-webkit-media-controls-current-time-display,
        video::-webkit-media-controls-time-remaining-display,
        video::-webkit-media-controls-mute-button,
        video::-webkit-media-controls-toggle-closed-captions-button,
        video::-webkit-media-controls-volume-slider,
        video::-webkit-media-controls-fullscreen-button {
            display: none !important;
            opacity: 0 !important;
            pointer-events: none !important;
            width: 0 !important;
            height: 0 !important;
        }
        
        /* é˜²æ­¢ iOS/Android å¼ºåˆ¶å…¨å± */
        video {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            object-fit: contain;
        }
    </style>
</head>

<body>
    <!-- æ’­æ”¾å™¨å®¹å™¨ (é»˜è®¤éšè—) -->
    <div class="player-container" id="playerContainer">
        <video id="videoElement" playsinline webkit-playsinline x-webkit-airplay="allow" controlslist="nodownload nofullscreen noremoteplayback" disablePictureInPicture preload="auto"></video>
        <div class="loading-spinner" id="loadingSpinner"></div>

        <div class="gesture-hint" id="gestureHint"></div>

        <div class="gesture-instructions" id="gestureInstructions">
            <h3>æ‰‹åŠ¿æ§åˆ¶è¯´æ˜</h3>
            <ul>
                <li>â†”ï¸ å·¦å³æ»‘åŠ¨ - å¿«è¿›/å¿«é€€</li>
                <li>â†•ï¸ ä¸Šä¸‹æ»‘åŠ¨ - è°ƒèŠ‚éŸ³é‡[å·¦ä½å³é«˜]</li>
                <li>ğŸ‘† åŒå‡» - æ’­æ”¾/æš‚åœ</li>
                <li>â© é•¿æŒ‰ - 2å€é€Ÿæ’­æ”¾</li>
            </ul>
            <p>ç‚¹å‡»ä»»æ„ä½ç½®å…³é—­</p>
        </div>

        <div class="controls-container" id="controlsContainer">
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="controls-row">
                <button class="control-btn play-pause-btn" id="playPauseBtn">
                    <svg viewBox="0 0 24 24">
                        <path id="playIcon" d="M8 5v14l11-7z" />
                    </svg>
                </button>

                <div class="time-display" id="timeDisplay">00:00 / 00:00</div>

                <button class="control-btn" id="volumeBtn">
                    <svg viewBox="0 0 24 24">
                        <path id="volumeIcon" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                    </svg>
                </button>

                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="1">

                <button class="control-btn" id="fullscreenBtn">
                    <svg viewBox="0 0 24 24">
                        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- æç¤ºä¿¡æ¯å®¹å™¨ (é»˜è®¤æ˜¾ç¤º) -->
    <div class="instruction-container" id="instructionContainer">
        <h2>é™æ€API-æ’­æ”¾å™¨</h2>
        <p>è¯·ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€æ–¹å¼åŠ è½½è§†é¢‘ï¼š</p>
        <code>å½“å‰ç½‘ç«™?type=video|img&wmurl=è§†é¢‘å›¾ç‰‡ç›´é“¾[éœ€URLç¼–ç ]</code>
        <code>å½“å‰ç½‘ç«™?type=video|img&lanzouwmurl=è“å¥äº‘é“¾æ¥</code>

        <div class="url-tool-container">
            <textarea id="urlInput" placeholder="è¾“å…¥URL..."></textarea>
            <div class="url-tool-buttons">
                <button id="encodeBtn">ç¼–ç </button>
                <button id="decodeBtn">è§£ç </button>
                <button id="copyBtn">å¤åˆ¶</button>
                <button id="clearBtn">æ¸…ç©º</button>
            </div>
        </div>
        <div class="footer-info">
            <p class="author-credit">ä½œè€…ï¼šæŒ½æ¢¦â¡é—é…’ &nbsp;&nbsp; &nbsp;&nbsp;
                <a href="https://f.wps.cn/ksform/w/write/Z1gwVE3I#routePromt" style="display: inline-block; 
          padding: 6px 12px; 
          background: var(--main-color); 
          color: white; 
          text-decoration: none; 
          border-radius: 4px; 
          margin-left: 10px;
          transition: opacity 0.2s;">å‰å¾€ä¸»é¡µ</a>

            </p>
        </div>


    </div>

    <script>
        // ======================
        // 1. DOMå…ƒç´ è·å–
        // ======================
        const playerContainer = document.getElementById('playerContainer');
        const instructionContainer = document.getElementById('instructionContainer');
        const videoElement = document.getElementById('videoElement');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playIcon = document.getElementById('playIcon');
        const timeDisplay = document.getElementById('timeDisplay');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const volumeBtn = document.getElementById('volumeBtn');
        const volumeIcon = document.getElementById('volumeIcon');
        const volumeSlider = document.getElementById('volumeSlider');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const controlsContainer = document.getElementById('controlsContainer');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const gestureHint = document.getElementById('gestureHint');
        const gestureInstructions = document.getElementById('gestureInstructions');
        const urlInput = document.getElementById('urlInput');
        const encodeBtn = document.getElementById('encodeBtn');
        const decodeBtn = document.getElementById('decodeBtn');
        const copyBtn = document.getElementById('copyBtn');
        const clearBtn = document.getElementById('clearBtn');
        
        // ======================
        // 2. å…¨å±€å˜é‡å£°æ˜
        // ======================
        let touchStartX = 0;
        let touchStartY = 0;
        let isLeftSide = false;
        let isRightSide = false;
        let currentOperation = null; // 'seek'|'volume_up'|'volume_down'|'fastforward'
        let longPressTimer = null;
        let controlsVisible = true;
        let isImageMode = false;
        let lastDoubleTapTime = 0;
        let controlsTimeout;
        let titleInterval;
        
        // ======================
        // 3. ç¼“å­˜ç³»ç»Ÿ
        // ======================
        const linkCache = {
        get: function(url) {
            const cached = localStorage.getItem(`cache_${encodeURIComponent(url)}`);
            if (!cached) return null;
            
            try {
                const { data, expire } = JSON.parse(cached);
                if (expire > Date.now()) {
                    return data;
                }
                localStorage.removeItem(`cache_${encodeURIComponent(url)}`);
            } catch (e) {
                console.error('ç¼“å­˜è§£æé”™è¯¯:', e);
            }
            return null;
        },
        
        set: function(url, data) {
            const expireTime = Date.now() + 15 * 60 * 1000; // 10åˆ†é’Ÿæœ‰æ•ˆæœŸ
            const cacheData = { data, expire: expireTime };
            localStorage.setItem(`cache_${encodeURIComponent(url)}`, JSON.stringify(cacheData));
        },
        
        clearExpired: function() {
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('cache_')) {
                    try {
                        const cached = JSON.parse(localStorage.getItem(key));
                        if (cached.expire <= Date.now()) {
                            localStorage.removeItem(key);
                        }
                    } catch (e) {
                        localStorage.removeItem(key);
                    }
                }
            });
        }
        };
        
        // ======================
        // 4. APIé…ç½®
        // ======================
        const LANZOU_API_LIST = [
        {
            name: "bugpk",
            url: (url) => `https://api.bugpk.com/api/lanzou?url=${encodeURIComponent(url)}`,
            parser: (data) => data.code === 200 ? data.data.url : null,
        },
        {
            name: "jkyai",
            url: (url) => `https://api.jkyai.top/API/lzypjx.php?url=${encodeURIComponent(url)}`,
            parser: (data) => data.code === 200 ? data.data.direct_url : null,
        },
        {
            name: "kxzjoker",
            url: (url) => `https://api.kxzjoker.cn/api/lanzou?&url=${encodeURIComponent(url)}`,
            parser: (data) => data.code === 200 ? data.downUrl : null,
        }
        ];
        
        // ======================
        // 5. å·¥å…·å‡½æ•°
        // ======================
        function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function showGestureHint(text) {
        gestureHint.textContent = text;
        gestureHint.style.opacity = '1';
        clearTimeout(gestureHint.hideTimer);
        gestureHint.hideTimer = setTimeout(() => {
            gestureHint.style.opacity = '0';
        }, 1000);
        }
        
        function updateVolumeIcon() {
        if (videoElement.muted || videoElement.volume === 0) {
            volumeIcon.setAttribute('d', 'M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zm-13-.5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z');
        } else if (videoElement.volume < 0.5) {
            volumeIcon.setAttribute('d', 'M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z');
        } else {
            volumeIcon.setAttribute('d', 'M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z');
        }
        }
        
        function showControls() {
        if (isImageMode) return;
        
        if (!controlsVisible) {
            controlsVisible = true;
            controlsContainer.style.opacity = '1';
        }
        hideControlsAfterDelay();
        }
        
        function hideControlsAfterDelay() {
        clearTimeout(controlsTimeout);
        controlsTimeout = setTimeout(() => {
            controlsContainer.style.opacity = '0';
            controlsVisible = false;
        }, 1000);
        }
        
        // æµè§ˆå™¨æ ‡é¢˜äº¤æ›¿æ˜¾ç¤ºå‡½æ•°
        function startTitleAnimation(customName) {
            const defaultTitle = "é™æ€API-æ’­æ”¾å™¨ä¸¨æŒ½æ¢¦â¡é—é…’ æä¾›";
            let showDefault = true;
            
            // å…ˆæ˜¾ç¤ºé»˜è®¤æ ‡é¢˜
            document.title = defaultTitle;
            
            titleInterval = setInterval(() => {
                if (showDefault) {
                    document.title = customName;
                } else {
                    document.title = defaultTitle;
                }
                showDefault = !showDefault;
            }, 2001); // 2.001ç§’åˆ‡æ¢ä¸€æ¬¡
        }
        
        // ======================
        // 6. æ ¸å¿ƒåŠŸèƒ½å‡½æ•°
        // ======================
        async function parseLanzouUrl(lanzouUrl) {
        try {
            loadingSpinner.style.display = 'block';
            showGestureHint('æ­£åœ¨è§£æé“¾æ¥...');
            
            // å…ˆæ£€æŸ¥ç¼“å­˜
            const cached = linkCache.get(lanzouUrl);
            if (cached) {
                showGestureHint('ä½¿ç”¨ç¼“å­˜æ•°æ®');
                return cached;
            }
            
            // å¹¶å‘è¯·æ±‚æ‰€æœ‰API
            const requests = LANZOU_API_LIST.map(async (api) => {
                try {
                    const response = await fetch(api.url(lanzouUrl));
                    const data = await response.json();
                    return api.parser(data);
                } catch (error) {
                    console.error(`${api.name} æ¥å£è¯·æ±‚å¤±è´¥:`, error);
                    return null;
                }
            });
        
            // ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ
            const results = (await Promise.all(requests)).filter(Boolean);
            
            if (results.length === 0) {
                throw new Error("æ‰€æœ‰APIè§£æå¤±è´¥");
            }
        
            // ä½¿ç”¨ç¬¬ä¸€ä¸ªæˆåŠŸçš„ç»“æœ
            const fileUrl = results[0];
        
            // ç¼“å­˜ç»“æœ
            linkCache.set(lanzouUrl, fileUrl);
            return fileUrl;
        } catch (error) {
            console.error('è§£æé”™è¯¯:', error);
            showGestureHint('è§£æå‡ºé”™: ' + error.message);
            return null;
        } finally {
            loadingSpinner.style.display = 'none';
        }
        }
        
        async function getMediaUrlFromParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const type = urlParams.get('type');
        let mediaUrl = urlParams.get('wmurl');
        const lanzouUrl = urlParams.get('lanzouwmurl');
        const nameParam = urlParams.get('name');
        
        // è®¾ç½®æ’­æ”¾æ¨¡å¼
        isImageMode = type === 'img';
        
        // å¤„ç†è‡ªå®šä¹‰æ ‡é¢˜
        if (nameParam) {
            try {
                let decodedName = nameParam;
                while (decodedName !== decodeURIComponent(decodedName)) {
                    decodedName = decodeURIComponent(decodedName);
                }
                startTitleAnimation(decodedName);
            } catch (e) {
                console.error('æ ‡é¢˜è§£ç é”™è¯¯:', e);
            }
        } else {
            if (titleInterval) clearInterval(titleInterval);
        }
        
        // å¤„ç†ç¼–ç çš„URLå‚æ•°
        if (mediaUrl) {
            try {
                // å°è¯•è§£ç URLï¼ˆå¯èƒ½è¢«å¤šæ¬¡ç¼–ç ï¼‰
                while (mediaUrl !== decodeURIComponent(mediaUrl)) {
                    mediaUrl = decodeURIComponent(mediaUrl);
                }
                return mediaUrl;
            } catch (e) {
                console.error('URLè§£ç é”™è¯¯:', e);
                return null;
            }
        } else if (lanzouUrl) {
            return await parseLanzouUrl(lanzouUrl);
        }
        return null;
        }
        
        function showGestureInstructions() {
        gestureInstructions.classList.add('show');
        
        // ç‚¹å‡»ä»»æ„ä½ç½®å…³é—­è¯´æ˜
        document.addEventListener('click', function hideInstructions() {
            gestureInstructions.classList.remove('show');
            document.removeEventListener('click', hideInstructions);
        }, { once: true });
        
        // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            gestureInstructions.classList.remove('show');
        }, 5000);
        }
        
        async function initMedia() {
        // å…ˆæ˜¾ç¤ºæ’­æ”¾å™¨å®¹å™¨ï¼Œéšè—æŒ‡ä»¤å®¹å™¨
        playerContainer.style.display = 'block';
        instructionContainer.style.display = 'none';
        
        const mediaUrl = await getMediaUrlFromParams();
        
        if (mediaUrl) {
            playerContainer.style.display = 'block';
            instructionContainer.style.display = 'none';
            
            if (isImageMode) {
                // å›¾ç‰‡æ¨¡å¼ - æ¸…é™¤æ‰€æœ‰å­å…ƒç´ å¹¶æ˜¾ç¤ºå›¾ç‰‡
                while (playerContainer.firstChild) {
                    playerContainer.removeChild(playerContainer.firstChild);
                }
                
                const imgElement = document.createElement('img');
                imgElement.src = mediaUrl;
                imgElement.style.width = '100%';
                imgElement.style.height = '100%';
                imgElement.style.objectFit = 'contain';
                playerContainer.appendChild(imgElement);
                
                // éšè—æ§åˆ¶æ 
                controlsContainer.style.display = 'none';
            } else {
                // è§†é¢‘æ¨¡å¼
                loadingSpinner.style.display = 'block';
                videoElement.src = mediaUrl;
                
                videoElement.addEventListener('loadedmetadata', () => {
                    loadingSpinner.style.display = 'none';
                    videoElement.muted = true;
                    videoElement.play()
                        .then(() => {
                            videoElement.muted = false;
                            showGestureInstructions();
                        })
                        .catch(e => console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', e));
                });
                
                videoElement.addEventListener('pause', () => {
                    showGestureHint("åŒå‡»æ’­æ”¾");
                    setTimeout(() => {
                        gestureHint.style.opacity = '0';
                    }, 2000);
                });
                
                videoElement.addEventListener('error', (e) => {
                    console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e);
                    loadingSpinner.style.display = 'none';
                    showGestureHint('è§†é¢‘åŠ è½½å¤±è´¥');
                });
                
                videoElement.addEventListener('waiting', () => loadingSpinner.style.display = 'block');
                videoElement.addEventListener('playing', () => loadingSpinner.style.display = 'none');
            }
        } else {
            playerContainer.style.display = 'none';
            instructionContainer.style.display = 'flex';
        }
        }
        
        function togglePlayPause() {
        if (videoElement.paused) {
            videoElement.play();
            playIcon.setAttribute('d', 'M6 19h4V5H6v14zm8-14v14h4V5h-4z');
        } else {
            videoElement.pause();
            playIcon.setAttribute('d', 'M8 5v14l11-7z');
        }
        showControls();
        }
        
        // ======================
        // 7. äº‹ä»¶ç›‘å¬å™¨
        // ======================
        // URLå·¥å…·ç›¸å…³äº‹ä»¶
        encodeBtn.addEventListener('click', function() {
        try {
            const originalText = urlInput.value.trim();
            if (!originalText) {
                alert('è¯·è¾“å…¥éœ€è¦ç¼–ç çš„å†…å®¹');
                return;
            }
            urlInput.value = encodeURIComponent(originalText);
        } catch (e) {
            alert('ç¼–ç å‡ºé”™: ' + e.message);
        }
        });
        
        decodeBtn.addEventListener('click', function() {
        try {
            const encodedText = urlInput.value.trim();
            if (!encodedText) {
                alert('è¯·è¾“å…¥éœ€è¦è§£ç çš„å†…å®¹');
                return;
            }
            urlInput.value = decodeURIComponent(encodedText);
        } catch (e) {
            alert('è§£ç å‡ºé”™: ' + e.message);
        }
        });
        
        copyBtn.addEventListener('click', function() {
        if (!urlInput.value.trim()) {
            alert('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
            return;
        }
        urlInput.select();
        document.execCommand('copy');
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
        
        clearBtn.addEventListener('click', function() {
        urlInput.value = '';
        });
        
        // æ’­æ”¾å™¨æ§åˆ¶ç›¸å…³äº‹ä»¶
        playPauseBtn.addEventListener('click', togglePlayPause);
        
        progressContainer.addEventListener('click', (e) => {
        const rect = progressContainer.getBoundingClientRect();
        const pos = (e.clientX - rect.left) / rect.width;
        videoElement.currentTime = pos * videoElement.duration;
        showControls();
        });
        
        volumeSlider.addEventListener('input', () => {
        videoElement.volume = volumeSlider.value;
        updateVolumeIcon();
        showControls();
        });
        
        volumeBtn.addEventListener('click', () => {
        videoElement.muted = !videoElement.muted;
        if (videoElement.muted) {
            volumeSlider.value = 0;
        } else {
            volumeSlider.value = videoElement.volume;
        }
        updateVolumeIcon();
        showControls();
        });
        
        fullscreenBtn.addEventListener('click', () => {
        if (!document.fullscreenElement) {
            playerContainer.requestFullscreen();
        } else {
            document.exitFullscreen();
        }
        showControls();
        });
        
        // è§†é¢‘å…ƒç´ äº‹ä»¶
        videoElement.addEventListener('timeupdate', () => {
        const current = formatTime(videoElement.currentTime);
        const duration = formatTime(videoElement.duration);
        timeDisplay.textContent = `${current} / ${duration}`;
        
        if (currentOperation !== 'seek') {
            const progress = (videoElement.currentTime / videoElement.duration) * 100;
            progressBar.style.width = `${progress}%`;
        }
        });
        
        videoElement.addEventListener('pause', () => {
        showGestureHint("åŒå‡»æ’­æ”¾");
        setTimeout(() => {
            gestureHint.style.opacity = '0';
        }, 2000);
        });
        
        videoElement.addEventListener('error', (e) => {
        console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e);
        loadingSpinner.style.display = 'none';
        showGestureHint('è§†é¢‘åŠ è½½å¤±è´¥');
        });
        
        videoElement.addEventListener('waiting', () => loadingSpinner.style.display = 'block');
        videoElement.addEventListener('playing', () => loadingSpinner.style.display = 'none');
        
        // æ‰‹åŠ¿æ§åˆ¶ç›¸å…³äº‹ä»¶
        document.addEventListener('touchstart', (e) => {
        if (isImageMode) return;
        
        currentOperation = null;
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        
        const windowWidth = window.innerWidth;
        isLeftSide = touchStartX < windowWidth / 3;
        isRightSide = touchStartX > windowWidth * 2 / 3;
        
        longPressTimer = setTimeout(() => {
            if (!currentOperation) {
                currentOperation = 'fastforward';
                videoElement.playbackRate = 2.0;
                showGestureHint("å¿«è¿›: 2.0x");
            }
        }, 800);
        
        showControls();
        });
        
        document.addEventListener('touchmove', (e) => {
        if (isImageMode) return;
        
        if (longPressTimer) {
            clearTimeout(longPressTimer);
            longPressTimer = null;
        }
        
        if (currentOperation === 'fastforward') return;
        
        const touch = e.touches[0];
        const deltaX = touch.clientX - touchStartX;
        const deltaY = touchStartY - touch.clientY;
        
        if (!currentOperation) {
            if (Math.abs(deltaX) > 15) {
                currentOperation = 'seek';
            } else if (Math.abs(deltaY) > 15) {
                const windowWidth = window.innerWidth;
                if (touchStartX > windowWidth / 2) {
                    currentOperation = 'volume_up'; // å³åŠéƒ¨åˆ†å‡é«˜éŸ³é‡
                    showGestureHint("éŸ³é‡ +");
                } else {
                    currentOperation = 'volume_down'; // å·¦åŠéƒ¨åˆ†é™ä½éŸ³é‡
                    showGestureHint("éŸ³é‡ -");
                }
            }
        }
        
        if (currentOperation === 'seek') {
            const windowWidth = window.innerWidth;
            const seekDistance = deltaX / windowWidth * videoElement.duration * 0.6;
            const newTime = Math.max(0, Math.min(videoElement.duration, videoElement.currentTime + seekDistance));
            
            videoElement.currentTime = newTime;
            const progressPercent = (newTime / videoElement.duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
            
            touchStartX = touch.clientX;
            showGestureHint(formatTime(newTime));
            e.preventDefault();
        } 
        else if (currentOperation === 'volume_up' || currentOperation === 'volume_down') {
            const volumeChange = Math.abs(deltaY) / 500;
            let newVolume;
            
            if (currentOperation === 'volume_up') {
                newVolume = Math.min(1, videoElement.volume + volumeChange);
            } else {
                newVolume = Math.max(0, videoElement.volume - volumeChange);
            }
            
            videoElement.volume = newVolume;
            volumeSlider.value = newVolume;
            updateVolumeIcon();
            showGestureHint(`éŸ³é‡: ${Math.round(newVolume * 100)}%`);
            
            touchStartY = touch.clientY;
            e.preventDefault();
        }
        });
        
        document.addEventListener('touchend', () => {
        if (isImageMode) return;
        
        if (longPressTimer) {
            clearTimeout(longPressTimer);
            longPressTimer = null;
        }
        
        if (currentOperation === 'fastforward') {
            videoElement.playbackRate = 1.0;
            showGestureHint("æ¢å¤æ­£å¸¸é€Ÿåº¦");
        }
        
        currentOperation = null;
        });
        
        document.addEventListener('touchend', (e) => {
        if (isImageMode) return;
        
        const currentTime = Date.now();
        if (currentTime - lastDoubleTapTime < 300 && currentOperation === null) {
            togglePlayPause();
            lastDoubleTapTime = 0;
        } else {
            lastDoubleTapTime = currentTime;
        }
        });
        
        // ======================
        // 8. åˆå§‹åŒ–ä»£ç 
        // ======================
        window.addEventListener('DOMContentLoaded', () => {
        linkCache.clearExpired();
        initMedia();
        
        if (getMediaUrlFromParams()) {
            hideControlsAfterDelay();
            document.addEventListener('mousemove', showControls);
        }
        });
    </script>

</body>

</html>
